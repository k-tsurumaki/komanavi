## ページ概要生成・深掘り導線・意図入力UI 設計書

### 1. 目的
- F-003（ページ概要提示）、F-004（概要の深掘り）、F-005（ユーザー意図入力）を段階表示で実装する。
- 既存の要約表示コンポーネントをベースに、概要は構造化表示へ移行する。
- 深掘りはチャット形式で提供し、意図入力は同じチャット枠内で切替表示する。
- 意図入力の確定時点で「回答生成開始」に遷移させる。

### 2. スコープ
- 対象フェーズ: 理解フェーズ（概要提示・深掘り）〜目的フェーズ（意図入力確定）。
- MVPではメッセージ履歴を永続保存しない（クライアント状態のみ）。
- チャットは解析API拡張（Option B）で実装する。
- 意図サジェストはスコープ外（将来検討）。
- 深掘り/意図入力はチャット枠内のプルダウンで切替する。

### 3. 画面・体験（段階表示）
#### 3.1 段階定義
1. 概要提示: 解析済みページの概要を構造化表示。
2. 深掘りチャット: ページ概要から気になる点を深掘り。
3. 意図入力: 「知りたいことを一文で」入力して確定（チャット内切替）。
4. 回答生成開始: 意図確定と同時に後続生成フェーズへ移行。

#### 3.4 概要表示の内容要件（F-003）
- 構造化JSONからUIでセクション表示する（Markdown表示は使用しない）。
- セクション構成: 対象者 / 目的 / ポイント（3〜5件） / 気をつけること。
- 「目的」セクション内に結論（conclusion）を併記する。

#### 3.3 段階インジケーター文言
- 段階インジケーターは廃止。

#### 3.2 主要UI要素
- 概要表示: 既存の要約表示コンポーネントに概要セクションを追加。
- 深掘りチャット: 会話履歴、自由入力欄、送信ボタン。
- 意図入力: 単文入力欄、例文ヒント。
- モード切替: チャット枠の右上プルダウンで深掘り/意図入力を切替。

### 4. フロー
1. 解析完了後、概要（平易化ページ）を表示。
2. 同一画面内のチャットで深掘りを開始。
3. プルダウンで「意図入力」に切替して意図を入力。
4. 意図確定 → 回答生成を開始。

#### 4.1 深掘りチャットの終了条件
- プルダウンで「意図入力」に切替。
- 切替時の自動要約は行わない。

### 5. 実装方針
#### 5.1 フロントエンド
- 既存の結果ページに概要＋チャットを統合。
- 深掘り/意図入力は同一チャット枠内のプルダウンで切替。
- 切替時にLLM要約リクエストは行わない。

#### 5.2 状態管理
- `messages` / `intent` / `deepDiveSummary` をストアに保持。
- `messages` は最大10往復相当で上限管理し、超過分は要約して `deepDiveSummary` に統合（表示はしない）。

#### 5.3 API
- 解析APIに `mode: deepDive` を追加し、チャット回答と要約を返却。
- 入力は `summary` + `messages` + `focus` を最小セットとする。

#### 5.4 中間表現への接続
- 意図確定時に `user_goal` と `focus` を中間表現生成へ渡す。
- 深掘り要約は `intent_summary` 作成の補助に利用する（UIでは非表示）。

### 6. 現状の実装内容（反映済み）
- 概要は構造化JSON `overview` を生成し、UIでセクション表示。
- 見出し: 「1分でわかる！平易化されたWebページ」。
- 概要セクション: 対象者 / 目的（結論を併記） / ポイント / 気をつけること。
- 深掘り・意図入力の切替はチャット枠内プルダウンで実施。
- 「やることチェックリスト」「漫画」「Google検索による情報取得」「根拠」は意図確定後に表示。