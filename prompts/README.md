# プロンプトファイル一覧

このディレクトリには、Gemini APIに送信するプロンプトファイルが格納されています。

## 処理フロー

```
┌─────────────────────────────────────────────────────────────────┐
│                      Webページ (URL)                             │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                     [スクレイピング]
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│               ScrapedContent (ページ内容)                        │
└─────────────────────────────────────────────────────────────────┘
          │                   │                   │
          ▼                   ▼                   ▼
   ┌───────────┐      ┌───────────────┐      ┌──────────┐
   │document-  │      │intermediate   │      │sources   │
   │type.txt   │      │.txt           │      │.txt      │
   └───────────┘      └───────────────┘      └──────────┘
          │                   │                   │
          ▼                   ▼                   ▼
   ドキュメント        構造化データ         根拠情報
   タイプ判定          生成                抽出
          │                   │                   │
          └───────────────────┴───────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│             IntermediateRepresentation (中間表現)                │
└─────────────────────────────────────────────────────────────────┘
                    │                   │
                    ▼                   ▼
            ┌───────────┐      ┌────────────────┐
            │checklist  │      │simple-summary  │
            │.txt       │      │.txt            │
            └───────────┘      └────────────────┘
                    │                   │
                    ▼                   ▼
            チェックリスト        やさしい要約
            (JSON配列)          (Markdown)
```

---

## 1. document-type.txt

| 項目 | 内容 |
|------|------|
| **使用関数** | `generateIntermediateRepresentation()` |
| **入力** | スクレイピングされたWebページの内容（URL、タイトル、セクション） |
| **目的** | 行政ドキュメントのタイプを分類する |
| **期待する出力** | JSON形式: `{"documentType": "xxx"}` |

### 出力するタイプ一覧

| タイプ | 説明 |
|--------|------|
| `benefit` | 給付・手当系（児童手当、介護保険、各種給付金） |
| `procedure` | 手続き系（転入届、パスポート申請、各種届出） |
| `information` | 情報提供系（お知らせ、制度説明） |
| `faq` | よくある質問 |
| `guide` | ガイド・案内 |
| `other` | その他 |

---

## 2. intermediate.txt

| 項目 | 内容 |
|------|------|
| **使用関数** | `generateIntermediateRepresentation()` |
| **入力** | スクレイピングされたWebページの内容（URL、タイトル、セクション） |
| **目的** | ページ内容を構造化されたJSONデータに変換する |
| **期待する出力** | `IntermediateRepresentation`型に準拠したJSON |

### 出力フィールド

```json
{
  "title": "ページタイトル",
  "summary": "2-3文の要約",
  "keyPoints": [
    { "id": "kp-001", "text": "...", "importance": "high|medium|low" }
  ],
  "target": {
    "conditions": ["対象条件1", "対象条件2"],
    "exceptions": ["例外1"],
    "eligibility_summary": "対象者の一言説明"
  },
  "procedure": {
    "steps": [{ "order": 1, "action": "...", "details": "...", "note": "..." }],
    "required_documents": ["必要書類1"],
    "deadline": "期限",
    "fee": "費用",
    "online_available": true
  },
  "benefits": {
    "description": "給付内容",
    "amount": "金額",
    "frequency": "支給頻度"
  },
  "contact": {
    "department": "担当部署",
    "phone": "電話番号",
    "hours": "受付時間"
  },
  "warnings": ["注意事項1"],
  "tips": ["便利な情報1"]
}
```

---

## 3. sources.txt

| 項目 | 内容 |
|------|------|
| **使用関数** | `generateIntermediateRepresentation()` |
| **入力** | スクレイピングされたWebページの内容（URL、タイトル、セクション） |
| **目的** | 重要な情報の根拠となる原文を抽出する |
| **期待する出力** | JSON配列形式 |

### 出力形式

```json
[
  {
    "source_id": "src-001",
    "section": "セクション名（対象者、支給額、期限など）",
    "original_text": "原文をそのまま引用"
  }
]
```

---

## 4. checklist.txt

| 項目 | 内容 |
|------|------|
| **使用関数** | `generateChecklist()` |
| **入力** | `IntermediateRepresentation`のJSONデータ（中間表現） |
| **目的** | ユーザーがやるべきことのチェックリストを作成する |
| **期待する出力** | `ChecklistItem[]`に準拠したJSON配列 |

### 出力形式

```json
[
  {
    "id": "check-001",
    "text": "やること（具体的に）",
    "category": "カテゴリ（準備、申請、確認など）",
    "deadline": "期限があれば記載",
    "priority": "high|medium|low"
  }
]
```

---

## 5. simple-summary.txt

| 項目 | 内容 |
|------|------|
| **使用関数** | `generateSimpleSummary()` |
| **入力** | `IntermediateRepresentation`のJSONデータ（中間表現） |
| **目的** | やさしい日本語で市民向けの要約を作成する |
| **期待する出力** | Markdown形式のテキスト（JSONではない） |

### 出力構成例

```markdown
## タイトル
簡潔な説明（2-3文）

## 主なポイント
- ポイント1
- ポイント2

## 必要な手続き（ある場合）
1. ステップ1
2. ステップ2

## 注意事項（ある場合）
- 注意点
```

---

## プロンプト作成時の共通注意事項

1. **JSONを出力する場合**: 「JSONのみ。説明文や前置き、コードフェンスは不要」と明記する
2. **やさしい日本語**: 難しい言葉を避け、短い文で記述する
3. **推測の禁止**: ページに書かれていない情報を追加しない
4. **重要情報の優先**: 期限、金額、必要書類など重要な情報は必ず含める

---

## 関連ファイル

- `src/lib/gemini.ts` - プロンプトを読み込んで使用する処理
- `src/lib/types/intermediate.ts` - 中間表現の型定義
